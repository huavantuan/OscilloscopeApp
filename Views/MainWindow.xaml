<Window
    x:Class="OscilloscopeApp.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:OscilloscopeApp"
    xmlns:ScottPlot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
    Title="Oscilloscope" Height="600" Width="900">
    <DockPanel>
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="10">
            <ComboBox Width="120" Margin="0,0,8,0" ItemsSource="{Binding Serial.AvailablePorts}" SelectedItem="{Binding Serial.SelectedPort}" />
            <TextBox Width="100" Margin="0,0,8,0" Text="{Binding Serial.BaudRate}" />
            <Button Width="110"
                    Content="{Binding Button.ConnectButtonText}"
                    Background="{Binding Button.ConnectButtonColor}"
                    Command="{Binding Button.ConnectButtonCommand}" />
            <Button Width="120" 
                    Content="Vẽ mô phỏng" 
                    Command="{Binding Simulate.SimulateButtonCommand}" 
                    Margin="8,0,0,0"/>
        </StackPanel>
        <DataGrid ItemsSource="{Binding Osc.ChannelConfigs}" AutoGenerateColumns="False"
                HeadersVisibility="Column" CanUserAddRows="False" Margin="10">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Kênh" Binding="{Binding ChannelIndex}" IsReadOnly="True" />
                <!-- Color Picker -->
                <DataGridTemplateColumn Header="Màu">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Background="{Binding ColorBrush}" Content="Chọn màu"
                                    Command="{Binding PickColorCommand}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Offset -->
                <DataGridTextColumn Header="Offset" Binding="{Binding Offset, Mode=TwoWay}" />

                <!-- Scale -->
                <DataGridTextColumn Header="Scale" Binding="{Binding Scale, Mode=TwoWay}" />
            </DataGrid.Columns>
        </DataGrid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />   <!-- vùng đồ thị -->
                <RowDefinition Height="Auto"/> <!-- vùng scroll -->
            </Grid.RowDefinitions>

            <!-- Oscilloscope plot -->
            <ScottPlot:WpfPlot x:Name="Plot" Grid.Row="0" />

            <!-- Scroll bar -->
            <ScrollBar  Orientation="Horizontal"
                        Minimum="0"
                        Maximum="{Binding Scroll.MaxOffset}"
                        Value="{Binding Scroll.CurrentOffset, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        Height="20"
                        Grid.Row="1"/>
        </Grid>
    </DockPanel>
</Window>